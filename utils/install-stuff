#!/bin/bash

set -e

me="`who | awk '{print $1}'`"

# Install essentials
apt-get install -y compizconfig-settings-manager vim curl git

# Still need:
# npm install -g surya
# sudo apt install net-tools
# sudo apt-get install android-tools-adb android-tools-fastboot # maybe not..
# vim-gnome
# Zoom
# pdftk
# pip
# exfat-fuse exfat-utils
# gnome-tweak-tool unity-tweak-tool dconf-editor
# snap install discord
# build-essential libssl-dev nvm

########################################
# Add repositories to apt sources & update

# Dropbox
if [[ -z "`grep Dropbox /etc/apt/sources.list`" ]]
then
  echo '' >> /etc/apt/sources.list
  echo '# Dropbox' >> /etc/apt/sources.list
  echo "deb [arch=i386,amd64] http://linux.dropbox.com/ubuntu `lsb_release -cs` main" >> /etc/apt/sources.list
  apt-key adv --keyserver pgp.mit.edu --recv-keys 1C61A2656FB57B7E4DE0F4C1FC918B335044912E
fi

# Docker
if [[ -z "`grep Docker /etc/apt/sources.list`" ]]
then
  echo '' >> /etc/apt/sources.list
  echo '# Docker' >> /etc/apt/sources.list
  echo "deb [arch=amd64] https://download.docker.com/linux/ubuntu `lsb_release -cs` stable" >> /etc/apt/sources.list
  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
fi

# Brave Browser
if [[ -z "`grep Brave /etc/apt/sources.list`" ]]
then
  echo '' >> /etc/apt/sources.list
  echo '# Brave' >> /etc/apt/sources.list
  echo "deb [arch=amd64] https://s3-us-west-2.amazonaws.com/brave-apt `lsb_release -sc` main" >> /etc/apt/sources.list
  curl https://s3-us-west-2.amazonaws.com/brave-apt/keys.asc | sudo apt-key add -
fi

# NodeJS
if [[ -z "`find /etc/apt/sources.list.d/ | grep nodesource`" ]]
then
  curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash -
fi

# KeePassX
if [[ -z "`find /etc/apt/sources.list.d/ | grep eugenesan`" ]]
then
  sudo add-apt-repository -y ppa:eugenesan/ppa
fi

# PHP
if [[ -z "`find /etc/apt/sources.list.d/ | grep php`" ]]
then
  sudo add-apt-repository ppa:ondrej/php
fi

# GIMP
if [[ -z "`find /etc/apt/sources.list.d/ | grep gimp`" ]]
then
  sudo add-apt-repository ppa:otto-kesselgulasch/gimp
fi

apt-get -y update

########################################
# Install everything else

apt-get install -y tree xclip wmctrl jq
apt-get install -y keepassx
apt-get install -y python-gpgme dropbox
apt-get install -y ca-certificates apt-transport-https software-properties-common docker-ce
apt-get install -y build-essential nodejs
apt-get install -y brave
apt-get install -y pandoc texlive-latex-recommended texlive-fonts-recommended texlive-xetex
apt-get install -y golang-go php7.1
apt-get install -y vlc-nox gimp

apt-get -y upgrade && apt-get -y autoremove

pandoc=pandoc-2.7.3-1-amd64.deb
wget https://github.com/jgm/pandoc/releases/download/2.7.3/$pandoc
dpkg -i $pandoc
rm $pandoc

# Docker post-installation setup
usermod -aG docker $me
systemctl enable docker
docker swarm init "--advertise-addr=127.0.0.1" 2> /dev/null

########################################
# Vim setup

# This folder will store our temporary backup files
mkdir -p ~/.vimtmp

# folders to store plugins
mkdir -p ~/.vim/autoload
mkdir -p ~/.vim/bundle
mkdir -p ~/.vim/undo

# https://github.com/tpope/vim-pathogen
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim

cd ~/.vim/bundle
[[ -d syntastic ]] || git clone -q --depth=1 https://github.com/vim-syntastic/syntastic.git
[[ -d vim-javascript ]] || git clone -q https://github.com/pangloss/vim-javascript.git
[[ -d vim-jsx ]] || git clone -q https://github.com/mxw/vim-jsx.git
[[ -d nerdtree ]] || git clone -q https://github.com/scrooloose/nerdtree.git
[[ -d vim-vinegar ]] || git clone -q https://github.com/tpope/vim-vinegar.git
[[ -d vim-solidity ]] || git clone -q https://github.com/tomlion/vim-solidity.git
[[ -d typescript-vim ]] || git clone -q https://github.com/leafgarland/typescript-vim.git
[[ -d supertab ]] || git clone -q https://github.com/ervandew/supertab

chown -R $me:$me ~/.vim

echo 'Success!'
